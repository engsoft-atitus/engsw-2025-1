{% extends "comunidade/base.html" %}
{% load static %}
  {% block content %}
  {% load tz %}
  <div class="container">
    <div class="community-block">
    
    <div class="titulo-comunidade-preview">
      <p class="nome">{{community.nome}}</p>
      <p class="tag">@{{community.nome_tag}}</p>
      </div>
    <p>{{community.sobre}}</p>
    <img
      src="{{ community.profile_picture.url }}"
      alt="Imagem de perfil"
      class="community-image"
    />
    
    {% if community.criador.id == user_id %} {# admin #}
    <div class="botoes-admin">
      <button>
        <a href="{% url 'community_edit' community.nome_tag %}">Editar</a>
      </button>
      <button>
        <a href="{% url 'community_delete' community.nome_tag %}">Deletar</a>
      </button>
    </div>
    
    <div class="posts-admin">
      <form action="{% url 'community_post' community.id %}" method="post">
        {% csrf_token %}
        {{form.body}}
        <button type="submit">Enviar</button>
      </form>
    </div>
    {% else %} 
      {% if not is_participating %} {# NÃ£o participando#}
  
      <form method="post" action="{% url 'join_community' community.id %}">
        {% csrf_token %}
        <button type="submit">Participar</button>
      </form>
  
      {% else %} {# Participando #}
      <div class="posts-admin">
      <form action="{% url 'community_post' community.id %}" method="post">
        {% csrf_token %}
        {{form.body}}
        <button type="submit">Enviar</button>
      </form>
    </div>
  
      <form method="post" action="{% url 'exit_community' community.id %}">
          {% csrf_token %}
          <button type="submit">Sair da comunidade</button>
        </form>
  
        {% endif %}
    {% endif %}
  
    <button>
      <a href="{% url 'my_communities' %}">Voltar</a>
    </button>
    
    {% for post in posts %}
      <section id="{{post.id}}" >
        <div class="centralizar">
        <div  class="comentario">
        
          <div class="usuario-post">
        <!--Placeholder para foto de perfil-->
        <img src="https://placecats.com/75/75" alt="profile picture" style="border-radius: 50%;">
        <!--Coloca um css pra fazer isso virar uma quadrado pq se tiver mais de 100 caracteres, o site quebra-->
        <h4>{{post.user.username}}</h4>
        
        </div>
        
        <p class="post-body">{{post.body}}</p>
	       
        <div class="low-post-section">
        
        {% localtime on %}
          <p>{{post.data_post|timezone:"America/Sao_Paulo"|date:"Y m d H:i"}}</p>
        {% endlocaltime %}
     
      <div id="{{post.id}}" class="like-section">
        {% if request.user in post.curtidores.all %}
        <button class="like-post" onclick="dislike(this.parentNode)">Dislike</button> 
        {% else %}
        <button class="like-post" onclick="like(this.parentNode)">Like</button>
        {% endif %}
      

       <p class="curtidas">{{post.curtidas}}</p>
      </div>
     
        
        </div>
      </div>
        {% if post.user == request.user %}
          <button class="edit-post" onclick="setEditPost(this.parentNode)">Editar</button>
          <button class="delete-post"><a href="{% url 'delete_post' post.id %}">Deletar</a></button>
          
        {% endif %}
      </section>
    {% endfor %}
    </div>
    <script src="{% static 'comunidade/community_preview.js' %}"></script>
  </div>
  {% endblock %}    
